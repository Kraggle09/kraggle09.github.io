<!DOCTYPE html>
<html lang="{{ page.lang | default: site.lang | default: " en" }}">

{%- include head.html -%}

<body>
  {%- include header.html -%}

  <main class="page-content" aria-label="Content">
    <div class="wrapper">
      {{ content }}
    </div>
  </main>

  {%- include footer.html -%}

  <script>
    (function () {
      // We create a couple variables
      const themes = ['auto', 'light', 'dark']; // A list of available themes
      const button = document.getElementById('theme-toggle'); // The button from footer.html
      const root = document.documentElement; // The root element

      // Declaring the setTheme function
      function setTheme(theme) { // Accepts a theme
        if (theme === 'auto') { // If the theme is set to auto...
          if (window.matchMedia('(prefers-color-scheme: dark)').matches === true){
            root.setAttribute('data-theme', 'dark');
          } else {
            root.setAttribute('data-theme', 'light');
          }
        } else { // Otherwise...
          root.setAttribute('data-theme', theme); // Set the theme to the inputted theme
        }
        localStorage.setItem('theme-button', theme); // Sets the cookie for the theme button (so it remembers your choice)
        button.textContent = theme.charAt(0).toUpperCase() + theme.slice(1); // Updates the text on the theme button
      }

      // Declaring the getNextTheme function
      function getNextTheme(current) { // Accepts the current theme
        const idx = themes.indexOf(current); // Grabs the current theme id
        return themes[(idx + 1) % themes.length]; // Sets the theme to the next item in the themes list
      }

      let currentTheme = localStorage.getItem('theme-button') || 'auto'; // Sets the currentTheme variable to the stored value in the cookies, or to auto if there is no cookie
      setTheme(currentTheme); // Sets the theme

      // Adds a new event to the button
      button.addEventListener('click', function () {
        currentTheme = getNextTheme(currentTheme); // Sets currentTheme to the next item in the list
        setTheme(currentTheme); // Sets the theme to currentTheme
      });

      // Looks for a change to the system theme
      window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', e => { // If it detects a change...
        if (localStorage.getItem('theme-button') === 'auto') { // If the theme is set to auto...
          setTheme('auto'); // Update the theme
          // Hold on, what does this do?
        }
      });
    })();
  </script>
</body>

</html>